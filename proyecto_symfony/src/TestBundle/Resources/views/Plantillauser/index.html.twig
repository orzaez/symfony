{% extends 'layout.html.twig' %}
{% block body %}
    {{ parent() }}
    <div class="container-fluid"> 
        <div class="col-md-12">
            <div class="title">
                <h2>Users list</h2>
            </div>
            <div class="table-responsive table">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Username</th>
                            <th>First name</th>
                            <th>Last name</th>
                            <th>Email</th>
                            <th>password</th>
                            <th>Role</th>
                            <th>Is_active</th>
                            <th>Created</th>
                            <th>Updated</th>
                            <th>Actions</th>
                            
                        </tr>
                    </thead>    
                    <tbody>
                    {% for usu in users  %}
                    <tr>
                            <td>{{ usu.id }}</td>
                            <td>{{ usu.username }}</td>
                            <td>{{ usu.getFirstName()}}</td>
                            <td>{{ usu.lastname }}</td>
                            <td>{{ usu.email }}</td>
                            <td>{{ usu.password }}</td>
                            <!-- <td>{{ usu.role }}</td> -->
                            <td>
                                {% if usu.role == 'ADMIN' %}
                                    <strong>Administrator</strong>
                                {% elseif usu.role == 'user' %}
                                    <strong>Usuario_basico</strong>
                                {% endif %}
                            </td>
                           
                            <td>{{ usu.getIsActive() }}</td>
                            <td>{{ usu.getCreatedAt()|date("d-m-y H:i") }}</td>
                            <td>{{ usu.getUpdatedAt()|date("d-m-y H:i") }}</td>
                            <td>
                                <a href="#" class="btn btn-sm btn-info">View</a>
                                <a href="#" class="btn btn-sm btn-primary">Edit</a>
                                <a data-id="{{ usu.id }}" id="delete" href="#" class="btn btn-danger btn-delete">Delete</a>
                            </td>
                        </tr>
                    </tbody>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>
{% endblock body %}
{% block javascripts  %}
{{ parent() }}

<script>
    $(document).ready(function () {
        $(".btn-delete").on("click", function () {
            var id=$(this).data("id");
            console.log(id);
            deleteuserAjax(id);
        });

        function deleteuserAjax(id){
            $.ajax({
                url: "{{ path('test_delete') }}",
                data: {
                    id:id
                },
                type: 'POST',
                dataType: 'json',
                success: function (data) {
                    console.log("success");
                    console.log (data);
                    if (data.status){
                        Swal.fire(
                        '!Bien hecho',
                        'El usuario se ha borrado correctamente',
                        'success')
                        location.reload();
                    }
                    else{
                        alert("error");
                        alert(data.msg);
                    }

                    /*$("#message").empty();
                    $("#message").append(data.html);
                    $("#message").show().delay(4000).fadeOut();
                    */
                },

                error: function (error) {
                    console.log("error");
                    console.log (error);
                    /*$("#message").empty();
                    $("#message").append(data.html);
                    $("#message").show().delay(4000).fadeOut();*/
                },
            });
        }
    });
</script>
{% endblock javascripts %}